---
description: Workflow conventions
---

- When if deps are missing (node_modules missing, vitest not found, or command not found), run the repo's package-manager install command (prefer lockfile/README-defined PM), then rerun the exact requested command once
- Use pnpm as the package manager. Minimum Node.js version is 22.12.0. Project requires pnpm@10.23.0 specified via packageManager field.
- Install pre-commit hooks with prek install (runs same checks as CI)
- Runtime requires Node 22+ (keep both Node and Bun paths working)
- CI requires Windows tests to pass. Tests run on Windows 2025 with limited concurrency (OPENCLAW_TEST_WORKERS=2) due to resource constraints.
- CI requires tests to pass on both Node.js and Bun runtimes. Run `pnpm canvas:a2ui:bundle && pnpm test` for Node, and `pnpm canvas:a2ui:bundle && bunx vitest run --config vitest.unit.config.ts` for Bun.
- CI requires `pnpm check` to pass before merge. This runs format check, type checking, and linting.
- Run `pnpm test` to execute tests. This uses a custom parallel test runner script (scripts/test-parallel.mjs) that orchestrates vitest.
- Use `oxlint --type-aware` for linting. This is the project's linter, configured via .oxlintrc.json.
- Run `pnpm check` before committing. This runs format check, type checking (tsgo), and linting in sequence.
- Use `pnpm build` to build the project. This runs canvas bundling, tsdown compilation, plugin SDK type generation, and copies build metadata.
- Release channels: stable (tagged releases vYYYY.M.D, npm dist-tag latest), beta (prerelease vYYYY.M.D-beta.N, npm dist-tag beta, may ship without macOS app), dev (moving head on main, no tag)
- "Bump version everywhere" means all version locations (package.json, Android build.gradle.kts, iOS/macOS Info.plist files, docs) EXCEPT appcast.xml - only touch appcast when cutting a new macOS Sparkle release
- Version locations: package.json (CLI), apps/android/app/build.gradle.kts (versionName/versionCode), apps/ios/Sources/Info.plist + apps/ios/Tests/Info.plist (CFBundleShortVersionString/CFBundleVersion), apps/macos/Sources/OpenClaw/Resources/Info.plist (CFBundleShortVersionString/CFBundleVersion), docs/install/updating.md (pinned npm version), docs/platforms/mac/release.md (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION)
- When you see unrecognized files, keep going; focus on your changes and commit only those
- When "sync" command given: if working tree is dirty, commit all changes (pick sensible Conventional Commit message), then git pull --rebase; if rebase conflicts and cannot resolve, stop; otherwise git push
- If staged+unstaged diffs are formatting-only, auto-resolve without asking; if commit/push already requested, auto-stage and include formatting-only follow-ups in same commit (or tiny follow-up commit if needed) with no extra confirmation - only ask when changes are semantic (logic/data/behavior)
- Restart iOS/Android apps means rebuild (recompile/install) and relaunch, not just kill/launch
- When debugging on macOS, start/stop gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff
- If git branch -d/-D <branch> is policy-blocked, delete the local ref directly with git update-ref -d refs/heads/<branch>
- Keep pnpm-lock.yaml and Bun patching in sync when touching deps/patches - both pnpm install and bun install are supported
- For bugs and small fixes, open a PR directly; for new features or architecture changes, start a GitHub Discussion or ask in Discord first
- When adding a new AGENTS.md anywhere in the repo, also add a CLAUDE.md symlink pointing to it (example: ln -s AGENTS.md CLAUDE.md)
- When adding channels/extensions/apps/docs, update .github/labeler.yml and create matching GitHub labels (use existing channel/extension label colors)
- Changelog: user-facing changes only - no internal/meta notes (version alignment, appcast reminders, release process)
- Prefer Bun for TypeScript execution (scripts, dev, tests): bun <file.ts> / bunx <tool>
- CI optimizes based on changed files. Docs-only PRs skip heavy jobs (test, build, Windows, macOS, Android). Lint and format always run.
- Mac packaging for dev: scripts/package-mac-app.sh defaults to current arch; release checklist: docs/platforms/mac/release.md
- iOS Team ID lookup: security find-identity -p codesigning -v â†’ use Apple Development (...) TEAMID; fallback: defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers
- If i18n pipeline is slow/inefficient and dragging, ping @jospalmbier on Discord instead of hacking around it
- Read docs/help/submitting-an-issue.md before submitting an issue
- Read docs/help/submitting-a-pr.md before submitting a PR
- Running multiple agents is OK as long as each agent has its own session
- Use ./scripts/clawlog.sh to query unified logs for OpenClaw subsystem on macOS - supports follow/tail/category filters and expects passwordless sudo for /usr/bin/log
- Run openclaw doctor to troubleshoot rebrand/migration issues or legacy config/service warnings (see docs/gateway/doctor.md)
- For skill contributions, head to ClawHub (https://clawhub.ai/) - the community hub for OpenClaw skills
- AI-assisted PRs are welcome and first-class citizens - mark as AI-assisted in PR title/description, note degree of testing, include prompts or session logs if possible, confirm you understand what the code does
- Development setup from source: git clone, pnpm install, pnpm ui:build (auto-installs UI deps on first run), pnpm build, then pnpm openclaw onboard --install-daemon
- Prefer pnpm for builds from source; Bun is optional for running TypeScript directly
- When working on a GitHub Issue or PR, print the full URL at the end of the task
- Follow concise, action-oriented commit messages (e.g., 'CLI: add verbose flag to send')
- Issue taxonomy from templates: Bug reports require summary, steps to reproduce, expected vs actual behavior, environment (version/OS/install method), and logs/screenshots. Feature requests require summary (problem/opportunity), proposed solution, alternatives considered, and additional context (links/screenshots/related issues).
- Before merging PRs, run `pnpm lint && pnpm build` as the merge gate. Tests may be included in the gate as well but can be skipped when there is a specific instruction to do so.
- Use a rebase-based workflow when merging PRs. Contributors should rebase onto upstream/main and ensure CI is green before requesting merge. Maintainers land PRs via rebase onto main.
