---
description: Testing conventions
---

- Code coverage thresholds are enforced: 70% lines, 70% functions, 55% branches, 70% statements. All new code must meet these minimums.
- Test files must follow the pattern `src/**/*.test.ts` or `extensions/**/*.test.ts`. All test files must use the `.test.ts` extension.
- Test timeouts are set to 120 seconds (120_000ms) by default, with hook timeout of 180 seconds on Windows. Plan for longer-running integration tests accordingly.
- Exclude live integration tests (*.live.test.ts) and e2e tests (*.e2e.test.ts) from the standard test suite. These run separately in CI.
- In Vitest test files that use `vi.mock()` module factories at the top level, use `vi.clearAllMocks()` or `vi.resetAllMocks()` in `afterEach` instead of `vi.restoreAllMocks()`. `restoreAllMocks()` restores spied-on properties to their original implementations, which breaks subsequent tests that rely on module-level mock exports still being `vi.fn()` â€” causing `vi.mocked()` calls to stop working.
