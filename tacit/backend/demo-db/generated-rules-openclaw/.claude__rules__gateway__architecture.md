---
description: Architecture conventions
---

- TypeBox schemas are the single source of truth for the Gateway WebSocket protocol. They drive runtime validation (AJV), JSON Schema export (dist/protocol.schema.json), and Swift codegen (apps/macos/Sources/OpenClawProtocol/GatewayModels.swift). One source of truth, everything else is generated.
- Remote Gateway deployment pattern: The Gateway can run on a small Linux instance while clients (macOS app, CLI, WebChat) connect over Tailscale Serve/Funnel or SSH tunnels. Device nodes (macOS/iOS/Android) pair to execute device-local actions when needed. Exec tool runs where the Gateway lives; device actions (system.run, camera, screen recording, notifications) run where the device lives via node.invoke.
- When resolving or timing out pending approval entries, always update snapshot fields (resolvedAtMs, decision, resolvedBy) before resolving the promise. This ensures getSnapshot() returns consistent data during any grace window where the entry is still accessible after resolution.
