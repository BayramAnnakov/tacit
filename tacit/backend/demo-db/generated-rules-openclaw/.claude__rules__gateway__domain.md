---
description: Domain conventions
---

- The WebSocket protocol has three frame types: Request (type: "req", id, method, params), Response (type: "res", id, ok, payload|error), and Event (type: "event", event, payload, seq?, stateVersion?). The first frame MUST be a connect request; any non-JSON or non-connect first frame causes a hard close.
- The Gateway is the single control plane for all messaging surfaces. It owns WhatsApp/Telegram/Slack/Discord/Signal/iMessage/WebChat connections and exposes a WebSocket API on port 18789 (default). Exactly one Gateway controls a single Baileys session per host.
- Tailscale exposure modes: Gateway can auto-configure Tailscale Serve (tailnet-only) or Funnel (public HTTPS). When enabled, gateway.bind must stay "loopback". Serve can require password auth via gateway.auth.mode: "password" or gateway.auth.allowTailscale: false. Funnel refuses to start unless gateway.auth.mode: "password" is set. Discovery TXT records include bridgeTls=1 and bridgeTlsSha256 when TLS is enabled.
- Idempotency requirement: Methods with side effects (send, agent, poll, chat.send) require an idempotencyKey in params to safely retry. The server keeps a short-lived dedupe cache to prevent duplicate execution.
- Protocol versioning: Clients send minProtocol + maxProtocol in connect request; server rejects mismatches. PROTOCOL_VERSION lives in src/gateway/protocol/schema.ts. Swift models preserve unknown frame types for forward compatibility.
- Bridge protocol is LEGACY: TCP JSONL node transport (port 18790) is deprecated. Current OpenClaw builds no longer ship the TCP bridge listener. New node clients should use the unified Gateway WebSocket protocol instead. Legacy bridge.* config keys are no longer part of the schema.
- Nodes (macOS/iOS/Android/headless) connect to the Gateway WebSocket with role: "node" and declare explicit capabilities/commands. They expose device-local actions like canvas.*, camera.*, screen.record, and location.get via node.invoke.
